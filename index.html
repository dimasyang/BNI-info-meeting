<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>æ ¸å¿ƒåœ˜æˆå“¡ï¼10/01~11/05ï¼šå‡ºå¸­/é²åˆ°/ç¼ºå¸­ï¼‹ä¾†è³“ï¼ˆå¯è¼¸å…¥ï¼‰ï¼‹ä¸€å°ä¸€ï¼‹çŸ©é™£ï¼‹äº®ç‡ˆ</title>
<style>
  :root{ --bg:#111; --card:#1b1b1b; --muted:#9aa0a6; --text:#e8eaed; --accent:#caaa00; --border:#2b2b2b; }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif}
  .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
  h1{font-size:20px;margin:0 0 12px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0 16px}
  button{background:#222;color:var(--text);border:1px solid var(--border);padding:8px 12px;border-radius:10px;cursor:pointer}
  button:hover{background:#262626}
  .tag{padding:4px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 20px #00000040;overflow:hidden}
  .table-wrap{overflow:auto;border-top:1px solid var(--border)}
  table{width:100%;border-collapse:separate;border-spacing:0}
  thead th{position:sticky;top:0;background:linear-gradient(180deg,#1f1f1f,#1a1a1a);z-index:3}
  th,td{border-bottom:1px solid var(--border);padding:10px 8px;text-align:center;white-space:nowrap}
  tbody tr:hover{background:#1c1c1c}
  th:first-child,td:first-child{position:sticky;left:0;background:inherit;z-index:2}
  th:nth-child(2),td:nth-child(2){position:sticky;left:60px;background:inherit;z-index:2}
  th:nth-child(3),td:nth-child(3){position:sticky;left:200px;background:inherit;z-index:2}
  th:nth-child(1){min-width:60px}
  th:nth-child(2){min-width:140px}
  th:nth-child(3){min-width:240px}
  .date-head{min-width:120px}
  .date-chip{display:inline-block;background:var(--accent);color:#000;padding:4px 10px;border-radius:8px;font-weight:600}
  .cell-wrap{display:flex;flex-direction:column;align-items:center;gap:6px}
  .status{display:inline-grid;place-items:center;width:32px;height:32px;border-radius:999px;border:1px solid var(--border);background:#111;cursor:pointer;user-select:none;position:relative}
  .status[aria-label="ğŸŸ¢"]{background:rgba(22,163,74,.12);border-color:rgba(22,163,74,.5)}
  .status[aria-label="ğŸŸ¡"]{background:rgba(202,138,4,.12);border-color:rgba(202,138,4,.5)}
  .status[aria-label="ğŸ”´"]{background:rgba(220,38,38,.12);border-color:rgba(220,38,38,.5)}
  /* ä¸€å°ä¸€äº®ç‡ˆï¼ˆæœ‰é…å°å°±äº®è—ç‡ˆï¼‰ */
  .status .o2o-dot{position:absolute;left:-6px;top:-6px;width:10px;height:10px;border-radius:50%;background:#3b82f6;border:1px solid var(--border);display:none}
  .status.o2o{background:rgba(59,130,246,.12);box-shadow:0 0 0 2px rgba(59,130,246,.35)}
  .status.o2o .o2o-dot{display:block}
  /* ä¾†è³“æ•¸å­—æ§åˆ¶ */
  .guest-wrap{display:flex;align-items:center;gap:4px}
  .guest-step,.guest-zero{font-size:11px;line-height:1;padding:3px 6px;border-radius:8px;border:1px solid var(--border);background:#222;color:#ddd;cursor:pointer}
  .guest-input{width:40px;text-align:center;background:#121212;color:var(--text);border:1px solid var(--border);border-radius:8px;padding:3px 4px}
  /* é…å°èˆ‡çŸ©é™£ */
  .pair-btn{font-size:11px;line-height:1;padding:3px 6px;border-radius:8px;border:1px solid var(--border);background:#222;color:#ddd;cursor:pointer}
  .pair-btn:hover{background:#2a2a2a}
  .o2o-pill{font-size:11px;padding:2px 6px;border:1px solid var(--border);border-radius:8px;background:#121212;color:#ccc}
  .totals{font-size:12px;display:flex;gap:8px;justify-content:center;color:var(--muted)}
  .dot{font-size:12px}
  .footer{color:var(--muted);padding:12px 16px}
  .search{margin-left:auto}
  input[type="search"]{background:#121212;color:var(--text);border:1px solid var(--border);padding:8px 10px;border-radius:10px;min-width:220px}
  .hint{color:var(--muted);font-size:12px;margin-top:6px}
  dialog{color:var(--text)}
  /* çŸ©é™£æ¨£å¼ */
  .matrix-card h2{font-size:16px;margin:16px}
  #matrixWrap{overflow:auto;border-top:1px solid var(--border)}
  #matrix{border-collapse:separate;border-spacing:0;width:100%}
  #matrix th,#matrix td{border-bottom:1px solid var(--border);border-right:1px solid var(--border);padding:8px 10px;text-align:center;white-space:nowrap}
  #matrix th:first-child,#matrix td:first-child{position:sticky;left:0;background:#171717;z-index:1}
  #matrix thead th{position:sticky;top:0;background:#171717;z-index:2}
  .diag{background:repeating-linear-gradient(45deg,#333 0,#333 4px,#222 4px,#222 8px)}

/* ==== Matrix tidy + RWD-stable (V3.7) ==== */
#matrix-wrap{ overflow-x:auto; }
#matrix{
  table-layout: fixed !important;
  width: max-content !important;
  border-collapse: separate !important;
  border-spacing: 0 !important;
}
#matrix *, #matrix th, #matrix td{ box-sizing: border-box !important; }
#matrix th, #matrix td{
  padding: 8px 10px !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  vertical-align: middle !important;
}
#matrix th:first-child, #matrix td:first-child{
  min-width: 140px !important;
  width: 140px !important;
  max-width: 140px !important;
}
#matrix thead th:not(:first-child), #matrix tbody td:not(:first-child){
  min-width: 72px !important;
  width: 72px !important;
  max-width: 72px !important;
}
/* lights */
#matrix td.lit{ background-color: rgba(59,130,246,0.28) !important; box-shadow: inset 0 0 0 2px rgba(59,130,246,.55) !important; border-color: rgba(59,130,246,.65) !important; font-weight:700; }
#matrix td.diag-self{ background-image: repeating-linear-gradient(135deg, rgba(255,255,255,0.16) 0px, rgba(255,255,255,0.16) 8px, transparent 8px, transparent 16px); background-color: rgba(250,204,21,0.18); box-shadow: inset 0 0 0 1px rgba(250,204,21, .45); position:relative; }
#matrix td.diag-self::after{ content:"â—"; position:absolute; right:6px; top:4px; font-size:12px; opacity:.75; }
#matrix td.diag-self.lit{ background-color: rgba(250,204,21,0.18) !important; box-shadow: inset 0 0 0 1px rgba(250,204,21, .45) !important; border-color: rgba(250,204,21, .45) !important; }

/* === Diagonal full-fill fix (V3.8) === */
#matrix td.diag-self{
  position: relative !important;
  overflow: hidden !important;
  background: none !important; /* we'll paint via ::before to ensure full cover */
}
#matrix td.diag-self::before{
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;
  background-image:
    repeating-linear-gradient(135deg, rgba(255,255,255,0.16) 0px, rgba(255,255,255,0.16) 8px, transparent 8px, transparent 16px),
    linear-gradient(rgba(250, 204, 21, 0.18), rgba(250, 204, 21, 0.18));
  z-index: 0 !important;
  pointer-events: none !important;
}
#matrix td.diag-self::after{
  z-index: 1 !important; /* the â— icon stays above the fill */
}

/* === Bottom-matrix-only light (v3.9) === */
#matrix td.lit{
  background-color: rgba(59,130,246,0.32) !important;
  box-shadow: inset 0 0 0 2px rgba(59,130,246,.6) !important;
  border-color: rgba(59,130,246,.7) !important;
  font-weight: 800;
}
/* ensure header or any other 'lit' elsewhere is unaffected */
:not(#matrix) td.lit, :not(#matrix) div.lit, :not(#matrix) span.lit { all: unset; }


/* === Matrix tidy layout v1 === */
#matrix table{border-collapse:collapse;table-layout:fixed;width:100%;}
#matrix th,#matrix td{border:1px solid #e5e7eb;text-align:center;vertical-align:middle;
  padding:6px 8px;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
#matrix th{background:#f8fafc;font-weight:600;}
#matrix td{background:#ffffff;}
#matrix td.diag{background:#f3f4f6;}
#matrix td.lit{background:rgba(255,214,102,.28);outline:2px solid rgba(255,184,0,.9);font-weight:700;}
/* fixed cell sizing for neat grid on desktop */
@media(min-width:1024px){
  #matrix th,#matrix td{width:48px;height:38px;}
}
/* make it scrollable on small screens */
#matrix .scroll-x{overflow-x:auto;-webkit-overflow-scrolling:touch;}
#matrix .scroll-x table{min-width:720px;}



<style>
/* === LightLock v3.2 (overlay only, no pointer-events tweak) === */
#authShield{
  position:fixed; inset:0; z-index:2147483646; /* on top */
  display:flex; align-items:center; justify-content:center;
  background:rgba(255,255,255,.9);
  -webkit-backdrop-filter:saturate(120%) blur(1px);
  backdrop-filter:saturate(120%) blur(1px);
}
#authShield.hidden{display:none;}
#authShield .tap{
  padding:10px 14px; border:1px solid #0f172a; border-radius:9999px;
  background:#fff; font-size:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.12);
}


<style>
/* === LightLock v4 === */
#authShield{position:fixed;inset:0;z-index:2147483646;display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,.85);backdrop-filter:saturate(120%) blur(1px);}
#authShield.hidden{display:none;}
#authShield .tap{width:14px;height:14px;border-radius:9999px;border:2px solid #111;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.12);}
</style>

</style>

</style>
</head>
<body>

<style>
#forceApplyBtn{position:fixed;right:12px;top:54px;z-index:99999;padding:6px 10px;border:1px solid #d1d5db;border-radius:8px;background:#fff;font-size:12px;cursor:pointer;opacity:.85}
#forceApplyBtn:hover{opacity:1}
</style>
<button id="forceApplyBtn" title="å¼·åˆ¶æŠŠæœ€è¿‘ä¸€æ¬¡é›²ç«¯è³‡æ–™å¥—åˆ°ç•«é¢">å¼·åˆ¶å¥—ç”¨é›²ç«¯</button>



<style>
/* === Toast UI (non-blocking) === */
#__toastRoot{position:fixed;right:16px;top:16px;z-index:2147483645;display:flex;flex-direction:column;gap:8px}
.toast{background:#111827;color:#fff;border-radius:10px;padding:10px 14px;font-size:13px;box-shadow:0 8px 24px rgba(0,0,0,.2);opacity:.98}
.toast.ok{background:#065f46}.toast.warn{background:#92400e}.toast.err{background:#7f1d1d}
.toast small{opacity:.9}
</style>
<div id="__toastRoot" aria-live="polite" aria-atomic="true"></div>




<style>
/* === Edit Gate UI === */
#editBar{position:fixed; right:12px; top:12px; z-index:99999; display:flex; gap:8px;}
#editBar button{padding:6px 10px; border:1px solid #d1d5db; border-radius:8px; background:#fff; font-size:12px; cursor:pointer;}
#editBar .on{border-color:#0ea5e9; box-shadow:0 0 0 2px rgba(14,165,233,.15);}
#editHint{position:fixed; right:12px; top:46px; z-index:99998; font-size:12px; color:#6b7280;}
</style>
<div id="editBar" aria-hidden="false">
  <button id="editToggleBtn" title="åˆ‡æ›ç·¨è¼¯">ç·¨è¼¯</button>
</div>



</div>
<div class="wrap">
<h1>æ ¸å¿ƒåœ˜æˆå“¡ï¼10/01 ~ 11/05ï¼ˆğŸŸ¢å‡ºå¸­ï½œğŸŸ¡é²åˆ°ï½œğŸ”´ç¼ºå¸­ï¼‰</h1>
<div class="toolbar">
<span class="tag">æ—¥æœŸï¼š10/01ã€10/08ã€10/15ã€10/22ã€10/29ã€11/05ï¼ˆç„¡è«‹å‡åˆ¶åº¦ï¼‰</span>
<span class="tag">ğŸ‘¥ ä¾†è³“ï¼š- / + / ç›´æ¥è¼¸å…¥ / 0 æ­¸é›¶</span>
<span class="tag">ğŸ¤ ä¸€å°ä¸€ï¼šæŒ‰ã€Œé…å°ã€å‹¾é¸å°è±¡ï¼Œæ•¸å­—è‡ªå‹•å¸¶å…¥ï¼Œæ ¼å­æœƒäº®è—ç‡ˆ</span>
<button id="importBtn">åŒ¯å…¥æˆå“¡</button>
<button id="saveBtn">å„²å­˜</button>
<button id="loadBtn">è®€å–</button>
<button id="clearBtn">æ¸…ç©º</button>
<button id="csvBtn">åŒ¯å‡ºCSV</button>
<button id="printBtn">åˆ—å°</button>
<input class="search" id="q" placeholder="å¿«é€Ÿæœå°‹å§“å/å°ˆæ¥­åˆ¥â€¦" type="search"/>
</div>
<div class="card">
<div class="table-wrap">
<table id="grid">
<thead>
<tr>
<th>#</th>
<th>å§“å</th>
<th>å°ˆæ¥­åˆ¥</th>
<th class="date-head"><span class="date-chip">10/01</span><div class="totals" data-date="2025-10-01"></div></th>
<th class="date-head"><span class="date-chip">10/08</span><div class="totals" data-date="2025-10-08"></div></th>
<th class="date-head"><span class="date-chip">10/15</span><div class="totals" data-date="2025-10-15"></div></th>
<th class="date-head"><span class="date-chip">10/22</span><div class="totals" data-date="2025-10-22"></div></th>
<th class="date-head"><span class="date-chip">10/29</span><div class="totals" data-date="2025-10-29"></div></th>
<th class="date-head"><span class="date-chip">11/05</span><div class="totals" data-date="2025-11-05"></div></th>
<th>å‡ºå¸­ç‡</th>
<th>ä¾†è³“ç¸½æ•¸</th>
<th>å¸¶ä¾†è³“æ¯”ç‡</th>
<th>ä¸€å°ä¸€æ¬¡æ•¸</th>
<th>ä¸€å°ä¸€æ¯”ç‡</th>
<th>ç¸½é«”ç¸¾æ•ˆ</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
<div class="footer">é»åœ“é»åˆ‡æ›ï¼šğŸŸ¢ â†’ ğŸŸ¡ â†’ ğŸ”´ â†’ ç©ºç™½ã€‚æ¯æ ¼å¯ç›´æ¥è¼¸å…¥ä¾†è³“æ•¸ï¼›æŒ‰ã€Œé…å°ã€å‹¾é¸å°è±¡å¾Œï¼Œä¸‹æ–¹çŸ©é™£æœƒè‡ªå‹•æ›´æ–°ã€‚è³‡æ–™ä¿å­˜åœ¨æœ¬æ©Ÿï¼ˆlocalStorageï¼‰ã€‚</div>
</div>
<!-- ä¸€å°ä¸€é…å°çŸ©é™£ï¼ˆå¾€ä¸‹æ‹‰ï¼‰ -->
<div class="card matrix-card" id="o2oMatrixCard" style="margin-top:16px;">
<h2>ä¸€å°ä¸€é…å°çŸ©é™£ï¼ˆéš¨ä¸Šæ–¹ã€Œé…å°ã€è¨­å®šè‡ªå‹•æ›´æ–°ï¼‰</h2>
<div id="matrixWrap"><div id="matrix-wrap"><table id="matrix"></table></div></div>
<div class="footer" style="color:#9aa0a6;">æ–œç·š=æœ¬äººï¼›æ•¸å­—=æ­¤æœŸé–“ä¸€å°ä¸€æ¬¡æ•¸ï¼ˆåŒä¸€å¤©åŒä¸€çµ„åªç®—ä¸€æ¬¡ï¼Œä¸é‡è¤‡ï¼‰ã€‚</div>
</div>
<div class="hint">CSV å«çµ±è¨ˆæ¬„ï¼‹ä¸€å°ä¸€æ¬„ä½ï¼›å¯ç›´æ¥è²¼åˆ° Excel/Google è©¦ç®—è¡¨ã€‚</div>
</div>
<!-- æˆå“¡åŒ¯å…¥å°è©±æ¡† -->
<dialog id="importDialog">
<form method="dialog" style="min-width:min(720px,90vw);background:#1b1b1b;border:1px solid var(--border);border-radius:12px;padding:16px;">
<h3 style="margin:0 0 8px;">åŒ¯å…¥æˆå“¡ï¼ˆæ¯åˆ—ï¼šç·¨è™Ÿ,å§“å,å°ˆæ¥­åˆ¥ï¼‰</h3>
<p style="color:#9aa0a6;">å¯è²¼ Excel è½‰å­˜çš„ CSVï¼Œæˆ–ä½¿ç”¨ TAB/é€—è™Ÿåˆ†éš”ã€‚åŒ¯å…¥å¾Œæœƒè¦†è“‹ç¾æœ‰åå–®ä¸¦é‡å»ºè¡¨æ ¼ã€‚</p>
<textarea id="importText" rows="10" style="width:100%;background:#121212;color:#eee;border:1px solid var(--border);border-radius:8px;padding:8px;white-space:pre;"></textarea>
<div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
<button value="cancel">å–æ¶ˆ</button>
<button id="doImport" value="default">åŒ¯å…¥</button>
</div>
</form>
</dialog>
<!-- ä¸€å°ä¸€é…å°å°è±¡é¸æ“‡ -->
<dialog id="pairDialog">
<form method="dialog" style="min-width:min(540px,90vw);background:#1b1b1b;border:1px solid var(--border);border-radius:12px;padding:16px;">
<h3 id="pairTitle" style="margin:0 0 8px;">é¸æ“‡ä¸€å°ä¸€å°è±¡</h3>
<div id="pairList" style="max-height:50vh;overflow:auto;border:1px solid var(--border);border-radius:8px;padding:8px;background:#121212"></div>
<div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
<button value="cancel">å–æ¶ˆ</button>
<button id="pairOK" value="default">ç¢ºå®š</button>
</div>
</form>
</dialog>


<!-- Firebase CDN (compat) -->






















<!-- === Cloud Debug Panel + Fixed DocId + Force Apply === -->
<style>
#__toastRoot{position:fixed;right:16px;top:16px;z-index:2147483647;display:flex;flex-direction:column;gap:8px}
.toast{background:#111827;color:#fff;border-radius:10px;padding:10px 14px;font-size:13px;box-shadow:0 8px 24px rgba(0,0,0,.2);opacity:.98}
.toast.ok{background:#065f46}.toast.warn{background:#92400e}.toast.err{background:#7f1d1d}
#cloudDiag{position:fixed;bottom:16px;right:16px;background:#0b1020;color:#e5f0ff;border:1px solid #3b82f6;border-radius:12px;padding:10px 12px;z-index:2147483646;box-shadow:0 8px 24px rgba(0,0,0,.35);font-size:12px;min-width:260px}
#cloudDiag h4{margin:0 0 6px 0;font-size:12px;font-weight:700;color:#93c5fd}
#cloudDiag pre{margin:6px 0;max-height:140px;overflow:auto;background:#0a0f1a;padding:6px 8px;border-radius:8px}
#cloudDiag .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
#cloudDiag button{padding:4px 8px;border:1px solid #93c5fd;background:#0a1222;color:#cfe1ff;border-radius:8px;cursor:pointer}
#cloudDiag small{opacity:.85}
</style>
<div id="__toastRoot"></div>
<div id="cloudDiag" role="status" aria-live="polite">
  <h4>é›²ç«¯è¨ºæ–·é¢æ¿</h4>
  <div class="row"><span>æ–‡ä»¶è·¯å¾‘</span><small id="cd_path">trafficSnapshots/core-team-traffic-v3</small></div>
  <div class="row"><span>rows é•·åº¦</span><small id="cd_len">-</small></div>
  <div class="row"><span>å«è³‡æ–™ï¼Ÿ</span><small id="cd_has">-</small></div>
  <div class="row"><span>ç¬¬ä¸€ç­†éµ</span><small id="cd_keys">-</small></div>
  <div class="row"><span></span><button id="cd_force">å¼·åˆ¶å¥—ç”¨é›²ç«¯</button></div>
  <pre id="cd_preview">ï¼ˆæˆåŠŸè®€å–å¾Œæœƒé¡¯ç¤ºå‰1ç­†å…§å®¹ï¼‰</pre>
</div>

<!-- === /Cloud Debug Panel === -->





<!-- ===== Force Render Layer for GitHub Pages ===== -->

<!-- ===== /Force Render Layer ===== -->


<!-- SAFE Firestore + Force Render (no try/catch) -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
<script>
  // Minimal toast
  (function(){var r=document.createElement('div');r.id='__toastRoot';r.style.cssText='position:fixed;right:16px;top:16px;z-index:2147483647;display:flex;flex-direction:column;gap:8px';document.addEventListener('DOMContentLoaded',function(){document.body.appendChild(r)});window.__toast=function(m){try{var e=document.createElement('div');e.style.cssText='background:#111827;color:#fff;border-radius:10px;padding:8px 12px;font-size:13px;box-shadow:0 8px 24px rgba(0,0,0,.2)';e.textContent=m;r.appendChild(e);setTimeout(function(){e.style.opacity='0';e.style.transition='opacity .25s';setTimeout(function(){e.remove()},260)},1800)}catch(e){}}})();
</script>
<script>
  // Firebase init (compat) + read
  (function(){
    var cfg = {
      apiKey: "AIzaSyDDZYbqfz-A5BcpKmO_TO8ot5AAp4bUeTE",
      authDomain: "bni-info-meeting.firebaseapp.com",
      projectId: "bni-info-meeting",
      storageBucket: "bni-info-meeting.firebasestorage.app",
      messagingSenderId: "943878549247",
      appId: "1:943878549247:web:a1ab47cbf589e3b1ab26ca",
      measurementId: "G-P2QGJ52GKW"
    };
    if (!firebase.apps.length) firebase.initializeApp(cfg);
    var db = firebase.firestore();
    var COLL = "trafficSnapshots";
    var DOC  = "core-team-traffic-v3";
    db.collection(COLL).doc(DOC).get().then(function(snap){
      if(!snap.exists){ console.warn("æ‰¾ä¸åˆ°æ–‡ä»¶", COLL + "/" + DOC); return; }
      var data = snap.data() || {};
      window.__FIRE_LAST_ROWS = Array.isArray(data.rows) ? data.rows : [];
      console.log("âœ… SAFE ç‰ˆï¼šrows =", window.__FIRE_LAST_ROWS.length);
      window.dispatchEvent(new CustomEvent("FIRE_ROWS_READY"));
    }).catch(function(err){
      console.error("SAFE ç‰ˆ Firestore éŒ¯èª¤ï¼š", err);
      __toast("Firestore éŒ¯èª¤ï¼š" + err.message);
    });
  })();
</script>
<script>
  // Infer date keys from visible labels like 10/01, 10/08...
  (function(){
    function infer(){
      if (Array.isArray(window.DATE_KEYS) && window.DATE_KEYS.length && Array.isArray(window.DATES) && window.DATES.length) return true;
      var re=/^\s*(\d{2})\/(\d{2})\s*$/;
      var mmdd=[];
      (document.querySelectorAll('th,button,div,span')||[]).forEach(function(el){
        var t=(el.textContent||'').trim();
        if(re.test(t)) mmdd.push(t);
      });
      mmdd = Array.from(new Set(mmdd));
      if(mmdd.length>=4){
        window.DATE_KEYS = mmdd.slice(0,8);
        var y = String(new Date().getFullYear());
        window.DATES = window.DATE_KEYS.map(function(s){ return y + '-' + s.replace('/','-'); });
        __toast("åµæ¸¬æ—¥æœŸéµï¼š"+window.DATE_KEYS.join(", "));
        return true;
      }
      return false;
    }
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(infer, 100); });
    setTimeout(infer, 800);
  })();
</script>
<script>
  // Force render even without applyRows()
  (function(){
    function forceRender(rows){
      if(!Array.isArray(rows)) return false;
      var DK = window.DATE_KEYS || [];
      var DS = window.DATES || [];
      var TB = document.getElementById('tbody') || document.querySelector('tbody');
      if(!TB) return false;
      var trs = TB.querySelectorAll('tr');
      for(var ri=0; ri<trs.length; ri++){
        var tr = trs[ri];
        var row = rows[ri] || {};
        var tds = tr.querySelectorAll('td');
        for(var di=0; di<DK.length; di++){
          var dispKey = DK[di], isoKey = DS[di];
          var cell = tds[3+di]; if(!cell) continue;
          var key = row.hasOwnProperty(dispKey) ? dispKey : row.hasOwnProperty(isoKey) ? isoKey : null;
          if(!key){
            if(/^\d{2}\/\d{2}$/.test(String(dispKey||''))){
              var y=(isoKey && /^\d{4}-\d{2}-\d{2}$/.test(isoKey))? isoKey.slice(0,4) : String(new Date().getFullYear());
              var iso2 = y + '-' + dispKey.replace('/','-');
              if(row.hasOwnProperty(iso2)) key = iso2;
            }
          }
          if(!key) continue;
          var lamp = row[key] || '';
          var g    = parseInt(row[key + '_g']) || 0;
          var o2o  = parseInt(row[key + '_1on1']) || 0;
          var partners = Array.isArray(row[key + '_p']) ? row[key + '_p'] : [];
          var status = cell.querySelector('.status');
          if(status){ status.textContent = lamp; status.setAttribute('aria-label', lamp); }
          var gInput = cell.querySelector('.guest-input');
          if(gInput){ gInput.value = String(g); }
          var pill = cell.querySelector('.o2o-pill');
          if(pill){ var n = partners.length>0? partners.length : o2o; pill.dataset.count=String(n); pill.textContent='ğŸ¤ '+n; }
          if(!status && !gInput && !pill){
            cell.innerHTML = '<div class="fr-cell"><span class="lamp">'+(lamp||'')+'</span><span class="mini">ğŸ‘¥'+o2o+'</span><span class="mini">ğŸ§‘â€ğŸ¦±'+g+'</span></div>';
          }
        }
      }
      return true;
    }
    function tryApply(){
      var rows = window.__FIRE_LAST_ROWS;
      if(!Array.isArray(rows)) return;
      var ok=false;
      if(typeof window.applyRows === 'function' && document.getElementById('tbody')){
        try { window.applyRows(rows); ok=true; __toast("å·²é€é applyRows æ¸²æŸ“"); } catch(e){}
      }
      if(!ok){
        if(forceRender(rows)){ __toast("å·²å¼·åˆ¶æ¸²æŸ“"); }
      }
    }
    window.addEventListener("FIRE_ROWS_READY", function(){ setTimeout(tryApply, 300); });
    document.addEventListener("DOMContentLoaded", function(){
      setTimeout(function(){
        if(Array.isArray(window.__FIRE_LAST_ROWS)){ tryApply(); }
      }, 1000);
    });
  })();
</script>

</body>
</html>
